---
title: "Stat 230 HW 4"
author: 'Name: Teagan Johnson'
output:
  pdf_document: default
  word_document: default
---
```{r, include=FALSE}
knitr::opts_chunk$set(collapse=TRUE, prompt=TRUE, comment=NULL)
```


### worked with: Alex Widman, Parker Johnson, and Miles Tisserand


Homework 4 is due **by 3pm Thursday, Oct. 14**. Please complete the assignment in this Markdown document, filling in your answers and R code below.  I didn't create answer and R chunk fields like I did with homework 1, but please fill in your answers and R code in the same manner as hw 1.  Submit  a hard copy of the **compiled pdf or word doc** either

  - in class 
  - in drop-in office hours 
  - in the paper holder outside my CMC 222 office door

Tips for using Markdown with homework sets:

- Work through a problem by putting your R code into R chunks in this .Rmd. Run the R code to make sure it works, then knit the .Rmd to verify they work in that environment.
    - Make sure you load your data in the .Rmd and include any needed `library` commands. 
- Feel free to edit or delete  questions, instructions, or code provided in this file when producing your homework solution. 
- For your final document, you can change the output type from `html_document` to `word_document` or `pdf_document`. These two to output types are better formatted for printing. 
  - on maize: you may need to allow for pop-ups from this site 
- If you want to knit to pdf while running Rstudio from your computer (*not* from maize), you  will need a LaTeX compiler installed on your computer. This could be [MiKTeX](https://miktex.org/), [MacTeX](http://www.tug.org/mactex/) (mac), or TinyTex. The latter is installed in R: first install the R package `tinytex`, then run the command `tinytex::install_tinytex()` to install this software. 
  - If you are using maize, you don't need to install anything to knit to pdf!


-------------------------------------


## Problem 1: Depression and Education:  ch. 9 exercise 19 parts (a), (b) and (c) 

##(19a) MLR Model for mean depression scores \

*Answer: * The MLR model is $\mu(depression \mid education, age) = \beta_0 + \beta_1age + \beta_2somecollege + \beta_3highschool + \beta_4(somecollege)(age) + \beta_5(highschool)(age)$. $\beta_5$ is the parameter that measures the the gap between categories (iii) and (i) since college education is our baseline, and $\beta_5$ measures the effect of high school experience with age.

##(19b) \

*Answer: * $\mu(depression \mid education=highschool) = \beta_0 + \beta_1age + \beta_3highschool + \beta_5(highschool)(age)$. $\beta_5$ is the parameter that measures the gaps between categories (i)/(ii) and (iii) since it compares the effect of high school education with age on depression vs. college education.

##(19c) \

*Answer: * $\mu(depression \mid education, age) = \beta_0 + \beta_1age + \beta_2somecollege + \beta_3highschool + \beta_4(somecollege)(age) + \beta_5(highschool)(age) + \beta_6(somecollege)(age-35)^2) + \beta_7(highschool)((age-35)^2)$

- Part (c) is missing its label in my version of your textbook, if this is the case in your textbook, then part (c) is the question that follows the part (b) question. 

- There **is no data for this problem**. Write down a *specific model mean function* $\mu(Y \mid X) = \beta_0 + ...$ **with indicator variables for factor levels**. 

- **Hint:** You must carefully write a mean function for both parts (a) and (b). You will be using dummy variables for your categorical variable, so you must define what the dummy variable(s) are indicating (i.e. which level are they identifying?). When trying to answer the questions about divergence, make sure to review the info provided for the problem - they are wondering if the difference in mean depression score for college (i) and high school only (iii) widens as people age.


---------------------------------


## Problem 2: Bat Echolocation
Use the data from case study 10.1.2 (`case1002`) to answer the questions below. 

### (2a) 
Use R to fit the parallel regression lines model for the regression of log energy on log mass and vertebrate type. (The same model fit in the case study). Note that your model summary will be different from display 10.6 because the baseline Type group set by R is different than the baseline used by the book. **Do not** change the baseline group in R to make your results look like display 10.6.

Use the summary results, write down the estimated mean models for each vertebrate type: (i) echolocating bats, (ii) non-echolocating bats and (iii) non-echolocating birds. Simplify your models/equations as much as possible  (e.g. give a formula with estimated slope and intercept for *each* of the three mean log energy lines, but no need to "unlog" your variables.) \

*Answer: * 

(i) $\mu(log(energy) \mid log(mass), type=echolocatingbats) = -1.4977 + 0.81496log(mass)$ \
(ii) $\mu(log(energy) \mid log(mass), type=nonecholocatingbats) = -1.4977 + 0.81496log(mass) - 0.0786637nonecholocatingbats$ \
(iii) $\mu(log(energy) \mid log(mass), type=nonecholocatingbirds) = -1.4977 + 0.81496log(mass) + 0.0235982nonecholocatingbirds$ \

```{r}
library(Sleuth3)
library(broom)
library(knitr)
head(case1002)
bats <- case1002

bats_lm <- lm(log(Energy) ~ log(Mass) + Type, data = bats)

kable(tidy((bats_lm)))
```

### (2b)
With results from (a), test whether the lines for the echolocating bats and non-echolocating birds coincide (e.g. are the same). \

*Answer: * Looking at the echolating bats and the non-echolating birds equations, it appears that they don't coincide. They are parallel, as they have the same slope, but their intercepts are different, so the lines will never touch. \
  
### (2c)
Do the following test: $H_0: \beta_2 = \beta_3$ vs. $H_A: \beta_2 \neq \beta_3$ where $\beta_2$ is the coefficient for the non-ecolocating bats and $\beta_3$ is the coefficient for the non-echolocating birds. Report the test stat and p-value for this test, then state your conclusion in context - carefully explaining what these hypotheses are stating about your model for log energy. \

*Answer: * The test statistic is $(-0.3881190 - 0.1497345)/(1^2(0.024837918)+1^2(0.041078883)+(2)(1)(1)(0.026439562)) = -0.8955993$. The corresponding p-value is 0.3822877 \
So, given beta 2 is equal to beta 3, there is a probability of 0.3822877 that we see our observed betas. We do not have sufficient evidence to reject the null hypothesis, so we can't disprove that beta 2 is equal to beta 3. So, we can conclude that the regression lines for non-echolocating bats and non-echolocating birds are similar. We don't need to have both betas since they are similar and we can get rid of one of them in the model. \

```{r}
vcov(bats_lm)
SE <- (0.024837918)+(0.041078883)+(-2)*(0.026439562)
gam <- (-0.0786637 - 0.0235982)
gam
sqrt(SE)
tstat = gam/sqrt(SE)
glance(bats_lm)$df.residual
2*pt(tstat, df=18)
tstat
```

### (2d)
Draw a  scatterplot of the data for this problem (colored by animal type) and add the parallel regression lines to the plot for each type of animal.  **Hint:** See the Stat 230 Notes [Section 3.4.1.1  example](https://kstclair.github.io/stat-230-notes/mlr.html#mlr-penguins1) for the correct way to draw a parallel line model in `ggplot2`.

```{r}
library(ggplot2)
bats_aug <- augment(bats_lm)
bats$fitted_vals = bats_aug$.fitted
ggplot(data = bats, 
       aes(y=log(Energy), x=log(Mass), color = Type)) + 
  geom_point() + 
  geom_line(aes(y = fitted_vals), size = 1) + 
  labs(title = "parallel lines model")
```



----------------------------------------



## Problem 3: Agstrat data revisited again
Recall the `agstrat.csv` data used for homework 1 and 2. This was a stratified random sample of US counties. We will consider the regression of farm acreage in 1992 (y) on farm acreage in 1982 (x).

```{r}
agstrat <- read.csv("http://people.carleton.edu/~kstclair/data/agstrat.csv")
```

### (3a) 
Fit the regression of the `log` of `acres92` on the `log` of `acres82` and `region` with rows 119 (New York County, NY) and 168 (Parish County, LA) removed from the data. (These counties have very low or 0 acres). Write down the fitted mean functions (models) for each of the four regions.  Simplify your models/equations as much as possible  (e.g. give a formula with estimated slope and intercept for each of the regions, but no need to "unlog" your variables.) \

*Answer: * 
$\mu(log(acres92) \mid log(acres82), region=NE) = -0.7251775 + 1.0539321log(acres82) - 0.0920789regionNE$ \
$\mu(log(acres92) \mid log(acres82), region=S) = -0.7251775 + 1.0539321log(acres82) - 0.0126336regionS$ \
$\mu(log(acres92) \mid log(acres82), region=W) = -0.7251775 + 1.0539321log(acres82) - 0.0248363regionW$ \

```{r}
agstrat_lm <- lm(log(acres92) ~ log(acres82) + region, data=agstrat, subset=-c(119, 168))
kable(tidy(agstrat_lm))
```

Note: you can omit one or more cases from a `lm` by adding a `subset` argument to the command. For example, adding `subset=-c(119,168)` to the `lm` command will omit rows 119 and 168 from your regression fit!

### (3b) 
Consider the t-test for the parameter $\beta_{NE}$ (the $\beta$ parameter for the NE region). Using the p-value given for the t-test, carefully interpret the result of this test. \

*Answer: * The t-stat is -2.61282 with a corresponding p-value of 0.004721599. Given the null hypothesis is true, or that farms in the Northeast don't have a different amount of farms per acre, there is a probability of 0.004721599 that we would see our observed result. Therefore, we have sufficient evidence to disprove the null hypothesis and conclude that the Northeast has a different amount of farms per acre.

```{r}
library(dplyr)
glance(agstrat_lm)$df.residual
t_stat = (-0.0920789-0)/(0.0352412)
t_stat
pt(t_stat, 290)
```


------------------------------------------



## Problem 4: Wages and Race
Consider ch.10 exercise 29 to answer the following questions. Review the background info for this exercise and data coding provided by the exercise description. We will still consider whether the CPS provides evidence of racial discrimination with respect to wages after accounting for factors like education, experience and location. Here is the model we are considering for this problem:
$$\begin{split}
\mu(\log(WeeklyEarnings)) &= \beta_0 + \beta_1 Educ + \beta_2 Exper + \beta_3 RaceNotBlack + \beta_4 MetStatus + \beta_5 regionNE \\
& +\beta_6 regionS + \beta_7 regionW + \beta_8 regionNE \times RaceNotBlack \\
& +\beta_9 regionS \times RaceNotBlack+ \beta_{10} regionW\times RaceNotBlack
\end{split}$$

### (4a)
Write down the model mean function for Black males in the midwest region. Then repeat this for non-Black males in the midwest. Which **one** parameter ($\beta$) measures the difference in mean earnings between Black and non-Black populations in the midwest region? \

*Answer: * $\mu(\log(WeeklyEarnings)) = \beta_0 + \beta_1 Educ + \beta_2 Exper + \beta_4 MetStatus$ \
$\mu(\log(WeeklyEarnings)) = \beta_0 + \beta_1 Educ + \beta_2 Exper + \beta_3 RaceNotBlack + \beta_4 MetStatus$ \
$\beta_3$ measures the difference in mean earnings between black and non-black populations in the midwest region. \

### (4b)
Write down the model mean function for Black males in the northeast region. Then repeat this for non-Black males in the northeast. Which **combination** of parameters ($\beta$'s) measures the difference in mean earnings between Black and non-Black populations in the northeast region? \

*Answer: * $\mu(\log(WeeklyEarnings)) = \beta_0 + \beta_1 Educ + \beta_2 Exper + \beta_4 MetStatus + \beta_5 regionNE$ \
$\mu(\log(WeeklyEarnings)) = \beta_0 + \beta_1 Educ + \beta_2 Exper + \beta_3 RaceNotBlack + \beta_4 MetStatus + \beta_5 regionNE + \beta_8 regionNE \times RaceNotBlack$ \
$beta_3$ and $beta_8$ measure the difference in mean earnings between black and non-black populations in the northeast region.

### (4c)
Researchers are particularly interested in determining if the effect of race (Black/non-Black) on earnings of males differs by region, after controlling for region, education, experience, and metropolitan status. Explain why the model above can be used to answer this question. \

*Answer: * In the form of an ANOVA test, you can set each factor to zero to test the significance of each factor. Using ANOVA F-tests, we are able to see if certain betas have an effect on the weekly earnings of certain demographics.

### (4d)
Using  the data for exercise 29 (`ex1029`), create the `ggplot2` package boxplot of log earnings vs. race *faceted* by region (make sure to turn `eval=TRUE` in your homework): \

*Answer: * The boxplots show that on average, non-black people earn more per week than black people. So there's a clear relationship between race and weekly earnings. There is not, however, a clear relationship between region and weekly earnings. The average weekly earnings for people in each region (and sequentially each race) is very similar, which does not support the idea that the effect of race on earnings differs by region.

```{r, eval=TRUE}
ggplot(ex1029, aes(x=Race, y=WeeklyEarnings)) + 
  geom_boxplot() + 
  facet_wrap(~Region) + 
  scale_y_log10()
```
Explain what this plot shows about the relationship between earnings, race and region. Does it support the idea that the effect of race on earnings differs by region?

(note: you will actually fit this model and analyze it in HW 5!)


----------------------------------------------------



## Problem 5: Woodpecker nesting 
**No R work is needed (expect for qt command) - all the info for this problem is given below.** Recall the woodpecker example from the day 3 notes.  Below is the output for the regression of nest depth (cm) on air temp (Celsius), along with covariance matrix for the coefficients. Compute a 95% confidence interval for the mean response $\mu(depth \mid temp=8)=\beta_0 + \beta_1(8)$ when temp is 8 degrees Celsius using the facts about inference for linear combinations of coefficients from ch. 10 (section 10.4.3). Your CI should match (except for rounding error) the CI obtained in the day 3 notes using the `predict` command: 15.83 to 18.94 cm.

*Answer: * The 95% confidence interval for $\mu(depth \mid temp=8)=\beta_0 + \beta_1(8)$ is (18.93839, 15.83129). \

```{r}
wpdata<- read.csv("http://people.carleton.edu/~kstclair/data/woodpeckers.csv")
wood_lm<- lm(depth ~ temp, data = wpdata)
summary(wood_lm)
vcov(wood_lm)
est <- 20.12228 - 0.34218*(8)
SE <- sqrt(0.88406062 + (64)*(0.003552822) + 2*(8)*(-0.039081046))
SE
t_val <- qt(.975, 10)
est+t_val*SE
est-t_val*SE
``` 


----------------------------------------------------



## Problem 6: Gender stereotypes
A 2017 *Science* article studied gender stereotypes around intellect in 5-7 year old boys and girls ([link](http://science.sciencemag.org/content/355/6323/389)). For this problem we will look at some of the data collected for studies 3 and 4, contained in the data file `SteroTypeStudy34.csv`. For both these studies, researchers measured subject interest in either a game for "smart" people or a game for people who "try-hard." The response `interest` is a standardized measure of subject interest in the "smart" games, so higher `interest` means more interest expressed in that type of game than other study subjects. The variable `gender` records gender (boy/girl) and `age2` groups subjects into 5-year-old (`age5`) participants and 6- to 7-year-old (`age6and7`) participants. This mimics the use of age in some of the paper's results. 

```{r}
stereo <- read.csv("http://math.carleton.edu/kstclair/data/StereoTypeStudy34.csv")
```


### (6a) 
Create an EDA graph that explores whether the effect of `gender` on `interest` level is affected by the age of the subject (measured by `age2` *not* by `age`). Explain what your graph shows you. \

*Answer: * Looking at the exploratory box plots, it appears that boys have a lower interest in smart games than girls do when boys and girls are 5 years old. However, when boys and girls reach the ages of 6 and 7, it appears that boys have a higher interest in smart games. \

```{r}
library(ggResidpanel)
library(Sleuth3)
#head(stereo)
ggplot(stereo, aes(x=gender, y=interest)) + 
  geom_boxplot() +
  facet_wrap(~age2)
#summary(stereo_lm)
#resid_xpanel(stereo_lm)
```

### (6b)
Determine the appropriate regression model to model `interest` as a function of `gender` and `age2` that allows the effect of `gender` on `interest` to differ by `age2` group. Write down your model mean function in terms of $\beta$ parameters first (like was done at the start of problem 4), then fit the model in R. Then, holding age constant, write down the estimated mean interest level for girls and for boys. \

*Answer: * 
$\mu(interest \mid gender=girl, age2=6and7) = -0.1043526 + 0.3270072ageSixSeven + 0.1334093genderGirl - 0.5769082(genderGirl)(ageSixSeven)$ \

```{r}
#stereo
stereo_lm <- lm(interest ~ age2 + gender + age2:gender, data=stereo)
kable(tidy(stereo_lm))
-0.1043526 + 0.1334093*1
```

### (6c)
Use your model in (b) to determine if interest level in "smart" games differs by gender for the 5-year old age group. Give a p-value to support your conclusion and, if statistically significant, give and interpret a confidence interval for the effect of gender in this age group. \

*Answer: * The p-value for gendergirl is 0.5682771. This means that given the null hypothesis is true, or that interest level in "smart" games DOES NOT differ by gender for the 5-year old age group, there is a probability of 0.5682771 that we get our observed results. Therefore, we do not have sufficient evidence to disprove the null hypothesis and we can't disprove the fact that gender does not change the interest levels in "smart" games.

### (6d)
Repeat (c) but for the 6 to 7-year old age group. \

*Answer: * The p-value for the interaction between age 6-7 and the gender girl beta is 0.0481374. This means that given the null hypothesis is true, that there is no difference in interest for "smart" games for girls vs. boys that are 6 and 7 years old. Therefore, we have sufficient evidence to disprove the null hypothesis and can conclude that there is a difference in interest for "smart" games for girls vs. boys that are 6 and 7 years old.




